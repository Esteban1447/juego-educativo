<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aventuras de CorazÃ³n Alegre</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="shortcut icon" href="./img/luna.png" type="image/x-icon">
</head>
<body>
  <div id="app">
    <!-- Contenido dinÃ¡mico -->
  </div>

  <!-- Mascot (visible en todos los mÃ³dulos si se desea) -->
  <div id="mascot-container" class="hidden">
    <img src="./img/luna.png" alt="Luna la Conejita" id="mascot-luna">
    <div id="mascot-speech-bubble" class="speech-bubble">
      <p id="mascot-text">Â¡Hola! Soy Luna, Â¡vamos a jugar!</p>
    </div>
  </div>

  <!-- =========== PLANTILLAS DE MÃ“DULOS =========== -->

  <!-- Plantilla para la pantalla de estudiante (MENÃš PRINCIPAL) -->
  <template id="student-menu-template">
    <div class="estudiante">
      <h1>Â¡Hola <span id="student-name"></span>!</h1>
      <p>Un mundo para explorar, sentir y crear.</p>
      <div class="menu">
        <button id="start-art-module" class="menu-button-art">El bosque de los colores <span class="button-icon">ðŸŽ¨</span></button>
        <button id="start-story-module" class="menu-button-literature">El rincÃ³n de los cuentos <span class="button-icon">ðŸ“š</span></button>
        <button id="start-explore-module" class="menu-button-exploration">El jardÃ­n explorador <span class="button-icon">ðŸ¦‹</span></button>
        <button id="start-emotions-module" class="menu-button-emotions">La isla de las emociones <span class="button-icon">ðŸ˜Š</span></button>
        <button id="start-freeplay-module" class="menu-button-freeplay">El valle de las letras <span class="button-icon">ðŸ” </span></button>
      </div>
    </div>
  </template>

  <!-- Plantilla para el mÃ³dulo "El Bosque de los Colores" (ARTE) -->
  <template id="art-module-template">
    <div class="game-module" id="art-forest">
      <h2>El Bosque de los Colores</h2>
      <div class="module-content">
        <p>Â¡AquÃ­ podrÃ¡s pintar y crear obras maestras!</p>
        <div id="toolbar-art" class="toolbar">
          <button class="color-btn" data-color="red" style="background-color:red;"></button>
          <button class="color-btn" data-color="blue" style="background-color:blue;"></button>
          <button class="color-btn" data-color="yellow" style="background-color:yellow;"></button>
          <button class="color-btn" data-color="green" style="background-color:green;"></button>
          <button class="color-btn" data-color="black" style="background-color:black;"></button>
          <button id="eraser-btn">Goma</button>
          <input type="range" id="brush-size" min="2" max="50" value="5" title="TamaÃ±o del pincel">
          <button id="clear-canvas-art">Borrar Todo</button>
        </div>
        <canvas id="drawing-canvas" width="500" height="350" style="border:2px solid #ccc; cursor: crosshair;"></canvas>
      </div>
      <button id="back-to-menu-art" class="game-button">Volver al MenÃº</button>
    </div>
  </template>

  <!-- Plantilla para el mÃ³dulo "El RincÃ³n de los Cuentos" (LITERATURA) -->
  <template id="literature-module-template">
    <div class="game-module" id="story-corner">
      <h2>El RincÃ³n de los Cuentos</h2>
      <div class="module-content">
        <p>Â¡Descubre historias mÃ¡gicas y divertidas!</p>
        <div id="story-container" class="story-container">
          <div id="story-content"></div>
          <button id="new-story-btn" class="game-button">Nueva Historia</button>
        </div>
      </div>
      <button id="back-to-menu-literature" class="game-button">Volver al MenÃº</button>
    </div>
  </template>

  <!-- Plantilla para el mÃ³dulo "El JardÃ­n Explorador" (EXPLORACIÃ“N) -->
  <template id="exploration-module-template">
    <div class="game-module" id="explorers-garden">
      <h2>El JardÃ­n Explorador</h2>
      <div class="module-content">
        <p>Â¡Descubre los secretos de la naturaleza!</p>
        <div id="garden-scene" style="background-image: url('img/paisaje.png'); width: 500px; height: 400px; border: 2px solid #8FBC8F; margin:auto; position:relative; background-size:cover;">
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Butterfly/3D/butterfly_3d.png" 
                alt="Mariposa" class="explorable-item butterfly" 
                data-info="Â¡Una linda mariposa! Las mariposas ayudan a polinizar las flores.">
            
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Tulip/3D/tulip_3d.png" 
                alt="Flor Roja" class="explorable-item flower" 
                data-info="Â¡Un hermoso tulipÃ¡n! Las flores nos regalan colores y aromas.">
            
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Bird/3D/bird_3d.png" 
                alt="PÃ¡jaro" class="explorable-item bird" 
                data-info="Â¡Un pajarito cantor! Los pÃ¡jaros alegran el jardÃ­n con su mÃºsica.">
            
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Ant/3D/ant_3d.png" 
                alt="Hormiga" class="explorable-item ladybug" 
                data-info="Â¡Una hormiguita trabajadora! Las hormigas son muy organizadas y trabajan en equipo.">
            
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Sun/3D/sun_3d.png" 
                alt="Sol" class="explorable-item sun" 
                data-info="Â¡El sol brillante! Da luz y calor a todas las plantas para que crezcan.">
                
            <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Droplet/3D/droplet_3d.png" 
                alt="Agua" class="explorable-item water" 
                data-info="Â¡Gotitas de agua! El agua es muy importante para que todo crezca en el jardÃ­n.">
        </div>
      </div>
      <button id="back-to-menu-exploration" class="game-button">Volver al MenÃº</button>
    </div>
  </template>

  <!-- Plantilla para el mÃ³dulo "La Isla de las Emociones" (EMOCIONES) -->
  <template id="emotions-game-template">
    <div class="game-module" id="emotions-island">
      <h2>La Isla de las Emociones</h2>
      <div class="module-content">
        <div id="emotion-display-container">
          <img src="https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Grinning%20Face/3D/grinning_face_3d.png" alt="Carita de emociÃ³n" id="emotion-face-img">
        </div>
        <div id="emotion-options" class="options-grid">
          <!-- Los botones de opciÃ³n se generarÃ¡n aquÃ­ con JS -->
        </div>
      </div>
      <button id="next-emotion-button" class="game-button hidden">Siguiente EmociÃ³n</button>
      <button id="back-to-menu-emotions" class="game-button">Volver al MenÃº</button>
    </div>
  </template>

  <!-- Plantilla para el mÃ³dulo "El Castillo del Juego Libre" (JUEGO) -->
  <template id="freeplay-module-template">
    <div class="game-module" id="freeplay-castle">
      <h2>El Valle de las Letras</h2>
      <div class="module-content">
        <div id="letter-matching-game" class="game-section">
          <h3>Â¡Encuentra el sonido de la letra!</h3>
          <div id="target-letter" class="letter-display">
            <span id="current-letter"></span>
          </div>
          <div id="sound-buttons" class="letters-grid">
            <!-- Los botones de sonido se generarÃ¡n dinÃ¡micamente -->
          </div>
        </div>
      </div>
      <button id="back-to-menu-freeplay" class="game-button">Volver al MenÃº</button>
    </div>
  </template>


  <!-- Plantilla para la pantalla de docente (sin cambios) -->
  <template id="teacher-menu-template">
    <div class="docente">
      <h1>Bienvenido/a Profe <span id="teacher-name"></span></h1>
      <div class="menu">
        <button>Panel General</button>
        <button>GestiÃ³n de Actividades</button>
        <button>Resultados por Estudiante</button>
        <button>EstadÃ­sticas</button>
        <button>RetroalimentaciÃ³n</button>
        <button>Registrar nuevo usuario</button>
        <button>ConfiguraciÃ³n</button>
        <button>Cerrar sesiÃ³n</button>
      </div>
    </div>
  </template>

  <!-- Elementos de Audio para Sonidos -->
  <audio id="correct-sound" src="sounds/correct.mp3" preload="auto"></audio>
  <audio id="incorrect-sound" src="sounds/incorrect.mp3" preload="auto"></audio>
  <audio id="click-sound" src="sounds/click.mp3" preload="auto"></audio>
  <audio id="exploration-sound" src="sounds/discovery.mp3" preload="auto"></audio> <!-- Sonido para exploraciÃ³n -->


  <script src="game.js"></script>
  <script>
    // SimulaciÃ³n del usuario
    const usuario = {
      nombre: "PequeÃ±o",  // Cambiado de "Camila" a "Estudiante"
      tipo_usuario: "estudiante",
      edad: 5,
      nivel_actual: 1
    };

    const app = document.getElementById("app");
    const mascotContainer = document.getElementById("mascot-container");
    const mascotText = document.getElementById("mascot-text");
    const clickSound = document.getElementById('click-sound');

    // Plantillas
    const studentMenuTpl = document.getElementById("student-menu-template");
    const teacherMenuTpl = document.getElementById("teacher-menu-template");
    const artModuleTpl = document.getElementById("art-module-template");
    const literatureModuleTpl = document.getElementById("literature-module-template");
    const explorationModuleTpl = document.getElementById("exploration-module-template");
    const emotionsGameTpl = document.getElementById("emotions-game-template");
    const freeplayModuleTpl = document.getElementById("freeplay-module-template");

    function playClickSound() {
      if (clickSound) {
        clickSound.currentTime = 0;
        clickSound.play().catch(e => console.warn("Error al reproducir sonido click:", e));
      }
    }

    function lunaSpeaks(message, showMascot = true) {
      mascotText.textContent = message;
      if (showMascot) {
        mascotContainer.classList.remove("hidden");
      } else {
        mascotContainer.classList.add("hidden");
      }
    }

    function loadModule(templateNode, initFunctionName, backButtonId, welcomeMessage) {
        app.innerHTML = "";
        const moduleNode = templateNode.content.cloneNode(true);
        app.appendChild(moduleNode);

        if (typeof window[initFunctionName] === 'function') {
            window[initFunctionName](); // Llama a la funciÃ³n de inicializaciÃ³n del mÃ³dulo (definida en game.js)
        } else {
            console.warn(`FunciÃ³n de inicializaciÃ³n ${initFunctionName} no encontrada.`);
        }
        
        lunaSpeaks(welcomeMessage);
        
        document.getElementById(backButtonId).addEventListener("click", () => {
            playClickSound();
            showStudentMenu();
        });
    }

    function showStudentMenu() {
      app.innerHTML = "";
      const studentMenuNode = studentMenuTpl.content.cloneNode(true);
      studentMenuNode.getElementById("student-name").textContent = usuario.nombre;
      app.appendChild(studentMenuNode);
      lunaSpeaks(`Â¡Bienvenido! Â¿QuÃ© aventura elegimos hoy?`);  // Mensaje mÃ¡s general

      document.getElementById("start-art-module").addEventListener("click", () => { 
        playClickSound(); 
        loadModule(artModuleTpl, "initArtModule", "back-to-menu-art", "Â¡Usa tu imaginaciÃ³n y pinta algo maravilloso en el Bosque de Colores!");
      });
      document.getElementById("start-story-module").addEventListener("click", () => { 
        playClickSound(); 
        loadModule(literatureModuleTpl, "initLiteratureModule", "back-to-menu-literature", "Â¡Prepara tus oÃ­dos para cuentos fantÃ¡sticos en el RincÃ³n de los Cuentos!");
      });
      document.getElementById("start-explore-module").addEventListener("click", () => { 
        playClickSound(); 
        loadModule(explorationModuleTpl, "initExplorationModule", "back-to-menu-exploration", "Â¡Hay muchos secretos por descubrir en el JardÃ­n Explorador!");
      });
      document.getElementById("start-emotions-module").addEventListener("click", () => { 
        playClickSound(); 
        loadModule(emotionsGameTpl, "initEmotionGame", "back-to-menu-emotions", "Â¡Vamos a conocer las emociones en la Isla de las Emociones!");
      });
      document.getElementById("start-freeplay-module").addEventListener("click", () => { 
        playClickSound(); 
        loadModule(freeplayModuleTpl, "initFreeplayModule", "back-to-menu-freeplay", "Â¡En el Castillo del Juego Libre, la imaginaciÃ³n no tiene lÃ­mites!");
      });
    }

    function showTeacherMenu() {
      // ... (cÃ³digo de showTeacherMenu sin cambios)
      app.innerHTML = "";
      const teacherMenuNode = teacherMenuTpl.content.cloneNode(true);
      teacherMenuNode.getElementById("teacher-name").textContent = usuario.nombre;
      app.appendChild(teacherMenuNode);
      lunaSpeaks("", false); 
    }

    // LÃ³gica inicial
    if (usuario.tipo_usuario === "estudiante") {
      showStudentMenu();
    } else if (usuario.tipo_usuario === "docente") {
      showTeacherMenu();
    }
  </script>
</body>
</html>